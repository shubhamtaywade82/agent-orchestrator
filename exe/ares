#!/usr/bin/env ruby

$LOAD_PATH.unshift File.expand_path("../lib", __dir__)
require "ares_runtime"
require "optparse"

options = {}
OptionParser.new do |opts|
  opts.banner = "Usage: ares [options] \"task description\""

  opts.on("-d", "--dry-run", "Plan without execution") do |d|
    options[:dry_run] = d
  end

  opts.on("-g", "--git", "Enable git auto-branching/committing") do |g|
    options[:git] = g
  end

  opts.on("--tui", "Launch interactive TUI") do |t|
    options[:tui] = t
  end
end.parse!

if options[:tui]
  Ares::Runtime::Tui.start
  exit
end

task = ARGV.join(" ")

if task.empty?
  puts "Usage: ares [options] \"task description\""
  exit 1
end

Router.new.run(task, options)
